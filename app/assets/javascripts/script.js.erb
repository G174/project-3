// script for google maps
var map, infoWindow;

function initMap() {
  map = new google.maps.Map(document.getElementById('map'), {
    center: {
      lat: -34.397,
      lng: 150.644
    },
    zoom: 18
  });
  infoWindow = new google.maps.InfoWindow;

  // Try HTML5 geolocation.
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      var pos = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      };

      //activate form with post request to ctrl
      sendPos(pos)

      //enable this method to get group locations.
      groupLocations()

      infoWindow.setPosition(pos);
      infoWindow.setContent('Location found.');
      infoWindow.open(map);
      map.setCenter(pos);
    }, function() {
      handleLocationError(true, infoWindow, map.getCenter());
    });
  } else {
    // Browser doesn't support Geolocation
    handleLocationError(false, infoWindow, map.getCenter());
  }
}

function handleLocationError(browserHasGeolocation, infoWindow, pos) {
  infoWindow.setPosition(pos);
  infoWindow.setContent(browserHasGeolocation ?
    'Error: The Geolocation service failed.' :
    'Error: Your browser doesn\'t support geolocation.');
  infoWindow.open(map);
}

function sendPos(position){
  // console.log(position.lat);
  // console.log(position.lng);

  //--------DELETE THIS FOR PROD send random locations for dev purpose, mimic users at diff group_locations
  var locList  =
  [{'lat': 1.3306435,'lng': 103.9060051},
  {'lat': 1.2965676,'lng': 103.8499297},
  {'lat': 1.3659974,'lng': 103.8533953}]

  var position = locList[Math.round(Math.random()*2)]
  //--------End DELETE THIS FOR PROD
  // console.log('got location '+position);
  $.ajax({
    data: position,
    dataType: 'json',
    type: 'post',
    url: "/user_location"
    // url: "/groups_locations"
  });
}
function groupLocations(){
$.get( "/groups_locations" ).then(function(){
  console.log(gon.group_locations)
})
}

$(document).ready(function() {
  console.log('script.js loaded');
  console.log(gon.group_locations);
//if not appearing, check that group has been set, in groupscontrollers
})
